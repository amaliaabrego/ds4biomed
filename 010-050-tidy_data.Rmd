# Clean Data (Tidy)

Now that we have seen how to import a dataset as a dataframe object,
we can start the process of "cleaning" it.
We saw in the "Spreadsheets" Chapter (\@ref(spreadsheets)) that data could come in different
formats and "shapes" that serve different purposes.
Our Goal now is to start the process of making our dataset "clean
by making it more amenable to different visualization and modeling methods.
Cleaning, processing, wrangling, tidying, etc are all synonyms you may have heard being used
for this process
(others include screaming, cursing, and walking away).

```{r, echo=FALSE, fig.cap="\"Data Cowboy\" by Allison Horst."}
knitr::include_graphics("https://github.com/allisonhorst/stats-illustrations/raw/master/rstats-artwork/data_cowboy.png")
```

## What is tidy data?

A more formal definition for "clean" data.

Let's you work towards something.

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
```

## Column headers are values, not variable names

```{r}
tumor <- read_csv("./data/tumorgrowth_long.csv")
```

```{r}
tumor
```


```{r}
tumor_tidy <- tumor %>%
  pivot_longer(`0`:last_col(), names_to = "day", values_to = "size")
tumor_tidy
```

```{r}
tumor_tidy %>%
  group_by(Group, day) %>%
  summarize(avg_size = mean(size, na.rm = TRUE)) %>%
  mutate(day = as.numeric(day)) %>%
  arrange(Group, day)
```

## Multiple variables stored in one column

```{r}
tb <- read_csv("./data/tb_long.csv")
tb
```

```{r}
tb_long <- tb %>%
  pivot_longer(starts_with(c('m', 'f')))
tb_long
```

```{r}
tb_tidy <- tb_long %>%
  separate(name, into = c("sex", "age_group"), sep = 1)
tb_tidy
```

## Variables are stored in both rows and columns

```{r}
cms <- read_csv("./data/cms_utilization.csv")
```

```{r}
cms_long <- cms %>%
  pivot_longer(`2007`:last_col(), names_to = "year")
cms_long
```

```{r}
cms_tidy <- cms_long %>%
  pivot_wider(names_from = variable, values_from = value)
cms_tidy
```

## Additional Resources

Tidy data paper:
https://vita.had.co.nz/papers/tidy-data.html

More code heavy R documentation on tidy data:
https://cran.r-project.org/web/packages/tidyr/vignettes/tidy-data.html

r4ds Tidy Data Chapter:
https://r4ds.had.co.nz/tidy-data.html
